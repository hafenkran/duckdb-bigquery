# name: test/sql/storage/attach_update_table2.test
# description: Test UPDATE statement on tables
# group: [storage]

require bigquery

require-env BQ_ATTACH_DB_URL

statement ok
ATTACH 'project=test api_endpoint=http://${BQ_ATTACH_DB_URL}:9050 grpc_endpoint=${BQ_ATTACH_DB_URL}:9060' AS test (TYPE bigquery);

statement ok
DROP TABLE IF EXISTS test.dataset1.test_update;

statement ok
CREATE TABLE test.dataset1.test_update(i INTEGER, s VARCHAR, n VARCHAR);

statement ok
INSERT INTO test.dataset1.test_update VALUES (1, 'hi', 'y'), (2, 'hello', 'y'), (3, 'moin', 'y');

statement ok
UPDATE test.dataset1.test_update SET i=i+1 WHERE i>1;

query III
SELECT * FROM test.dataset1.test_update;
----
1	hi	y
3	hello	y
4	moin	y

statement ok
UPDATE test.dataset1.test_update SET i=i+100 WHERE s='hi';

query III
SELECT * FROM test.dataset1.test_update;
----
101	hi	y
3	hello	y
4	moin	y

statement ok
UPDATE test.dataset1.test_update SET s='hello' WHERE s='hi';

statement ok
UPDATE test.dataset1.test_update SET n='another string' WHERE i<100 AND s='hello';

query III
SELECT * FROM test.dataset1.test_update;
----
101	hello	y
3	hello	another string
4	moin	y
