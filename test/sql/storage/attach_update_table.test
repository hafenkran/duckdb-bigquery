# name: test/sql/storage/attach_update_table.test
# description: Test UPDATE statement on tables
# group: [storage]

require bigquery

require-env BQ_ATTACH_DB_URL

statement ok
ATTACH 'project=test api_endpoint=http://${BQ_ATTACH_DB_URL}:9050 grpc_endpoint=${BQ_ATTACH_DB_URL}:9060' AS test (TYPE bigquery);

statement ok
DROP TABLE IF EXISTS test.dataset1.test_update;

# multi column update in different orders
statement ok
CREATE TABLE test.dataset1.test_update(i INTEGER, j INTEGER, k INTEGER);

query I
INSERT INTO test.dataset1.test_update VALUES (1, 10, 100), (2, NULL, 200), (3, 30, NULL), (4, 40, 400);
----
4

query III
SELECT * FROM test.dataset1.test_update ORDER BY 1
----
1	10	100
2	NULL	200
3	30	NULL
4	40	400

statement ok
UPDATE test.dataset1.test_update SET k=990 + i, i=i, j=99 WHERE i=2 OR i=4

query III
SELECT * FROM test.dataset1.test_update ORDER BY 1
----
1	10	100
2	99	992
3	30	NULL
4	99	994

# duplicates in SET statements
statement error
UPDATE test.dataset1.test_update SET j=k, j=i
----
Multiple assignments to same column
